---
title: "Introduction"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(SimTOST)
```


 Methodology and Assumptions





# Hypotheses

The null and alternative hypotheses for the equivalence test are as follows:

## Difference of Means (DOM)
A common approach to assessing bioequivalence involves comparing the log-transformed pharmacokinetic (PK) measures between the test and reference products. This is done using the following interval (null) hypothesis:

Null Hypothesis ($H_0$): At least one endpoint does not meet the equivalence criteria:
 
$$H_0: m_T^{(j)} - m_R^{(j)} \le \delta_L ~~ \text{or}~~ m_T^{(j)} - m_R^{(j)} \ge \delta_U \quad \text{for at least one}\;j$$

Alternative Hypothesis ($H_1$): All endpoints meet the equivalence criteria:

$$H_1: \delta_L<m_{T}^{(j)}-m_{R}^{(j)} <\delta_U \quad\text{for all}\;j$$

Here, $m_T$ and $m_R$ represent the logarithmically transformed mean responses of the test product (the proposed biosimilar) and the reference product, respectively. The equivalence limits, $\delta_L$ and $\delta_u$, are typically chosen to be symmetric, such that  $\delta = - \delta_L = \delta_U$. The FDA further recommends that the equivalence acceptance criterion (EAC) be defined as $\delta = EAC = 1.5 \sigma_R$, where $\sigma_R$ represents the variability of the log-transformed endpoint for the reference product.

The null hypothesis ($H_0$) is rejected if, and only if, all null hypotheses associated with the $K$ primary endpoints are rejected at a significance level of $\alpha$. This ensures that equivalence is established across all endpoints simultaneously. 


## Ratio of Means (ROM)
The equivalence hypotheses can also be expressed as a Ratio of Means (ROM):

Null Hypothesis ($H_0$): At least one endpoint does not meet the equivalence criteria:
 
$$H_0: \frac{\mu_T^{(j)}}{\mu_R^{(j)}} \le E_L ~~ \text{or}~~ \frac{\mu_T^{(j)}}{\mu_R^{(j)}} \ge E_U \quad \text{for at least one}\;j$$

Alternative Hypothesis ($H_1$): All endpoints meet the equivalence criteria:

$$H_1: E_L< \frac{\mu_{T}^{(j)}}{\mu_{R}^{(j)}} < E_U \quad\text{for all}\;j$$

Here, $\mu_T$ and $\mu_R$ represent the arithmetic mean responses of the test product (the proposed biosimilar) and the reference product, respectively. 

## Regulatory Requirements 
When evaluating bioequivalence, certain statistical and methodological requirements must be adhered to, as outlined in the European Medicines Agency's bioequivalence guidelines [@CHMP2010]. These requirements ensure that the test and reference products meet predefined criteria for equivalence in terms of pharmacokinetic parameters. The key considerations are summarized below:

* Hypothesis testing should be based on the ratio of the population geometric means 
* The 90% confidence interval for the ratio of the test and reference products should be contained within the acceptance interval of 80.00 to 125.00%. 
* A margin of clinical equivalence ($\Delta$) is chosen by defining the largest difference that is clinically acceptable, so that a difference bigger than this would matter in practice. 
* The data should be transformed prior to analysis using a logarithmic transformation and subsequently be analyzed using ANOVA


# Log-Transformation and Parameter Adjustments in sampleSize()
In [sampleSize()](../reference/sampleSize.html), Ratio of Means (ROM) tests are converted to Difference of Means (DOM) tests by log-transforming the data. Equivalence limits are applied to the log-transformed data, and the results are back-transformed to the original scale for interpretation. This approach leverages the log-normal distribution of pharmacokinetic (PK) measures like AUC and Cmax.

## Logarithmic Mean
The logarithmic mean is derived from the provided `mu_list` (arithmetic means) and `sigma_list` (variances) using the following formula:

$$\text{Logarithmic Mean} = \log(\text{Arithmetic Mean}) - \frac{1}{2}\text{Variance}$$
This formula adjusts the arithmetic mean to account for the skewness of log-normal data, ensuring that the central tendency on the log scale aligns with the transformed data.

## Logarithmic Variance Transformation
To fully operate within the log-normal framework, the variances on the original scale (`sigma_list`) must also be transformed. The variance on the log scale is calculated using the normalized variance formula:
 
\[
\text{Logarithmic Variance} = \log\left(1 + \frac{\sigma^2}{\mu^2}\right)
\]

# Testing of multiple endpoints
It is often required to investigate equivalence for more than one primary variable. [@sozu_sample_2015] For example, EMA recommends showing equivalence both for AUC and Cmax 

A decision must be made as to whether it is desirable to 

* Demonstrate equivalence for all primary endpoints: most common setting (also known as **multiple co-primary endpoints**)
* Demonstrate equivalence for at least one of the primary endpoints (also known as **multiple primary endpoints**)


## Multiplicity

When a trial aims to evaluate the joint effects across all $m$ co-primary endpoints [@sozu_sample_2015], no multiplicity adjustment is required to control the Type I error rate, as all null hypotheses must be rejected to establish equivalence. However, as the number of endpoints ($K$) increases, the Type II error rate also increases. [@mielke_sample_2018] This leads to the following implications:

* The power to detect equivalence decreases for a fixed sample size.
* The probability of trial success is reduced as more endpoints are evaluated simultaneously.



# References
