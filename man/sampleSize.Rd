% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/SampleSize.R
\name{sampleSize}
\alias{sampleSize}
\title{Sample Size Calculation for Bioequivalence and Multi-Endpoint Studies}
\usage{
sampleSize(
  mu_list,
  varcov_list = NA,
  sigma_list = NA,
  cor_mat = NA,
  sigmaB = NA,
  Eper,
  Eco,
  rho = 0,
  TAR = rep(1, length(mu_list)),
  arm_names = NA,
  ynames_list = NA,
  type_y = NA,
  list_comparator = NA,
  list_y_comparator = NA,
  power = 0.8,
  alpha = 0.05,
  lequi.tol = NA,
  uequi.tol = NA,
  list_lequi.tol = NA,
  list_uequi.tol = NA,
  dtype = "parallel",
  ctype = "ROM",
  vareq = TRUE,
  lognorm = TRUE,
  k = NA,
  adjust = "no",
  dropout = NA,
  nsim = 5000,
  seed = 1234,
  ncores = NA,
  optimization_method = "fast",
  lower = 2,
  upper = 500,
  step.power = 6,
  step.up = TRUE,
  pos.side = FALSE,
  maxiter = 1000,
  verbose = FALSE
)
}
\arguments{
\item{mu_list}{Named list of arithmetic means per treatment arm. Each element contains a vector (i.e., one per treatment arm) with the expected outcomes for all endpoints of interest.}

\item{varcov_list}{list of var-cov matrices, each element corresponds to a comparator with a varcov matrix of size number of endpoints X number of endpoints.}

\item{sigma_list}{list of sigma vectors, each element corresponds to a comparator with a sigma vector of size number of endpoints.}

\item{cor_mat}{matrix specifying the correlation matrix between endpoints, used along with sigma_list  to calculate the varcov list in case it is not provided.}

\item{sigmaB}{number between subject variance only for 2x2 design.}

\item{Eper}{Optional. Vector of length 2 specifying the period effect in a \code{dtype = "2x2"} design, applied to c(Period 0, Period 1). Defaults to \code{c(0, 0)} if not provided. Ignored for \code{dtype = "parallel"}.}

\item{Eco}{Optional. Vector of length 2 specifying the carry-over effect for each arm in a \code{dtype = "2x2"} design, applied to c(Reference, Treatment). Defaults to \code{c(0, 0)} if not provided. Ignored for \code{dtype = "parallel"}.}

\item{rho}{Correlation parameter applied uniformly across all endpoint pairs, used with sigma_list to calculate varcov if cor_mat or varcov_list are not provided.}

\item{TAR}{Numeric vector. Treatment allocation rates for each arm, where the order of values corresponds to the order of \code{arm_names}. The length of \code{TAR} must match the number of arms. If not provided, a default equal allocation rate is assigned across all arms.}

\item{arm_names}{Optional vector with the treatment names. If not supplied, it will be derived from mu_list.}

\item{ynames_list}{Optional list of vectors with Endpoint names on each arm. When not all endpoint names are provided for each arm, arbitrary names (assigned by vector order) are used.}

\item{type_y}{vector with the type of endpoints: primary endpoint(1), otherwise (2).}

\item{list_comparator}{list of comparators, i.e each comparator is a vector of size 1 X 2 where are specified the name of treatments}

\item{list_y_comparator}{list of endpoints to be considered in each comparator. Each element of the list is a vector containing the names of the endpoints to compare. When it is not provided, all endpoints present in both compared arms are used.}

\item{power}{target power (default = 0.8)}

\item{alpha}{alpha level (default = 0.05)}

\item{lequi.tol}{lower equivalence bounds (e.g., -0.5) expressed in raw scale units (e.g., scalepoints) of endpoint repeated on all endpoints and comparators}

\item{uequi.tol}{upper equivalence bounds (e.g., -0.5) expressed in raw scale units (e.g., scalepoints) of endpoint repeated on all endpoints and comparators}

\item{list_lequi.tol}{list of lower equivalence bounds (e.g., -0.5) expressed in raw scale units (e.g., scalepoints) of endpoint in comparator}

\item{list_uequi.tol}{list of upper equivalence bounds (e.g., -0.5) expressed in raw scale units (e.g., scalepoints) of endpoint in comparator}

\item{dtype}{Character. Design type for the trial: \code{"parallel"} (default) for parallel group design or \code{"2x2"} for crossover design (applicable only for trials with 2 arms).}

\item{ctype}{Character. Specifies the type of hypothesis test for comparison: \code{"DOM"} for Difference of Means or \code{"ROM"} for Ratio of Means.}

\item{vareq}{Logical indicating whether variances are assumed equal across arms (default = FALSE).}

\item{lognorm}{Is data log-normally distributed? (TRUE, FALSE)}

\item{k}{Vector with the number of endpoints that must be successful (integer) for global bioequivalence for each comparator. If no k vector is provided, it will be set to the total number of endpoints on each comparator.}

\item{adjust}{Character. Method for alpha adjustment: \code{"k"} (K-fold), \code{"bon"} (Bonferroni), \code{"sid"} (Sidak), \code{"no"} (no adjustment, default), or \code{"seq"} (sequential adjustment).}

\item{dropout}{vector with proportion of total population with dropout per arm}

\item{nsim}{number of simulated studies (default=5000)}

\item{seed}{main seed}

\item{ncores}{Integer. Number of processing cores to use for parallel computation. Defaults to one less than the total number of detected cores.}

\item{optimization_method}{Character. Method for determining the required sample size: "fast" (using modified root-finding algorithms) or "step-by-step". Defaults to "fast".}

\item{lower}{Integer. Initial value of \code{N} for the search range. Defaults to 2.}

\item{upper}{Integer. Maximum value of \code{N} for the search range. Defaults to 500.}

\item{step.power}{Numeric. The initial step size for the sample size search, defined as \code{2^step.power}. Relevant when \code{optimization_method} is \code{"fast"}.}

\item{step.up}{Logical. If \code{TRUE} (default), the sample size search increments upward from the \code{lower} limit; if \code{FALSE}, it decrements downward from the \code{upper} limit. Used only when \code{optimization_method} is \code{"fast"}.}

\item{pos.side}{Logical. If \code{TRUE}, finds the smallest integer, \code{i}, closest to the root such that \code{f(i) > 0}. Used only when \code{optimization_method} is \code{"fast"}.}

\item{maxiter}{Integer. Maximum number of iterations allowed for finding the sample size. Defaults to 1000. Used only when \code{optimization_method} is \code{"fast"}.}

\item{verbose}{Logical. If \code{TRUE}, the function displays progress and informational messages during execution. Defaults to \code{FALSE}.}
}
\value{
An object simss that contains the following elements :
\describe{
\item{"response"}{ An array summarizing the results of the simulation, including the estimated sample sizes for each arm, the approximated achieved power, and the corresponding confidence interval.}
\item{"table.iter"}{A data frame detailing the estimated sample size for each arm and the calculated power at each iteration during the sample size searching process.}
\item{"table.test"}{A data frame containing the test results for all simulated trials, including relevant metrics for each tested sample size}
\item{"param.u"}{The original set of parameters provided by the user for the simulation.}
\item{"param"}{ The final set of parameters used for the sample size calculation. These are based on \code{param.u} but adjusted to address any inconsistencies or missing information.}
\item{"param.d"}{ The design parameters used in the simulation, including details relevant to the trial design.}
}
}
\description{
This function calculates the required sample size to achieve a target power in studies with multiple endpoints and treatment arms. The function leverages modified root-finding algorithms to estimate sample size while considering correlation structures, variance assumptions, and equivalence bounds across endpoints. It is especially useful for bioequivalence trials or multi-arm trials with complex endpoint structures.
}
\examples{

mu_list <- list(SB2 = c(AUCinf = 38703, AUClast = 36862, Cmax = 127.0),
                EUREF = c(AUCinf = 39360, AUClast = 37022, Cmax = 126.2),
                USREF = c(AUCinf = 39270, AUClast = 37368, Cmax = 129.2))

sigma_list <- list(SB2 = c(AUCinf = 11114, AUClast = 9133, Cmax = 16.9),
                   EUREF = c(AUCinf = 12332, AUClast = 9398, Cmax = 17.9),
                   USREF = c(AUCinf = 10064, AUClast = 8332, Cmax = 18.8))

# Equivalent boundaries
lequi.tol <- c(AUCinf = 0.8, AUClast = 0.8, Cmax = 0.8)
uequi.tol <- c(AUCinf = 1.25, AUClast = 1.25, Cmax = 1.25)

# Arms to be compared
list_comparator <- list(EMA = c("SB2", "EUREF"),
                        FDA = c("SB2", "USREF"))

# Endpoints to be compared
list_y_comparator <- list(EMA = c("AUCinf", "Cmax"),
                          FDA = c("AUClast", "Cmax"))

# Equivalence boundaries for each comparison
lequi_lower <- c(AUCinf = 0.80, AUClast = 0.80, Cmax = 0.80)
lequi_upper <- c(AUCinf = 1.25, AUClast = 1.25, Cmax = 1.25)

# Run the simulation
sampleSize(power = 0.9, alpha = 0.05, mu_list = mu_list,
           sigma_list = sigma_list, list_comparator = list_comparator,
           list_y_comparator = list_y_comparator,
           list_lequi.tol = list("EMA" = lequi_lower, "FDA" = lequi_lower),
           list_uequi.tol = list("EMA" = lequi_upper, "FDA" = lequi_upper),
           adjust = "no", dtype = "parallel", ctype = "ROM", vareq = FALSE,
           lognorm = TRUE, ncores = 1, nsim = 50, seed = 1234)
}
\references{
Mielke, J., Jones, B., Jilma, B., & König, F. (2018). Sample size for multiple hypothesis testing in biosimilar development. Statistics in Biopharmaceutical Research, 10(1), 39-49.

Berger, R. L., & Hsu, J. C. (1996). Bioequivalence trials, intersection-union tests and equivalence confidence sets. Statistical Science, 283-302.
}
\author{
Johanna Muñoz \email{johanna.munoz@fromdatatowisdom.com}
}
